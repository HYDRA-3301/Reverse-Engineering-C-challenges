# Phoenix format-zero
https://exploit.education/phoenix/format-zero/
## Static Analysis
##### Result
`Well done, the 'changeme' variable has been changed!`
##### Setup
```
https://hub.docker.com/r/duckll/ctf-box/
docker pull duckll/ctf-box
docker run -idt --name ctf duckll/ctf-box
docker start ctf
docker container exec -it ctf bash
```


##### Background
I tried a different setup for this challenge. I used a Docker container ( in `non-privileged` mode). This gave some excellent out-of-the-box stuff like `gdb's enhanced debugger`, nice `vi` color coding, `gcc` for compiling code, etc.

`gcc format_zero.c -o format_zero`

You get a big clue when you compile the code:

```
gcc format_zero.c -o format_zero
format_zero.c: In function ‘main’:
format_zero.c:26:24: warning: format not a string literal and no format arguments [-Wformat-security]
   sprintf(locals.dest, buffer);
```
#### snprintf
`man snprintf` tells a lot:

> int snprintf(char * restrict str, size_t size, const char * restrict format, ...);
>
> sprintf(), snprintf(), vsprintf(), and vsnprintf() write to
>      the character string str

The `...` tell you it is `variadic function`. That means you can pass in any number of arguments.


```
root@b8d0276ae4c8:~# ./format_zero
Welcome to https://exploit.education
%p %p %p
Well done, the 'changeme' variable has been changed!
```

##### Source code
```

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

int main(int argc, char **argv) {
  struct {
    char dest[32];
    volatile int changeme;
  } locals;
  char buffer[16];

  printf("%s\n", BANNER);

  if (fgets(buffer, sizeof(buffer) - 1, stdin) == NULL) {
    errx(1, "Unable to get buffer");
  }
  buffer[15] = 0;

  locals.changeme = 0;

  sprintf(locals.dest, buffer);

  if (locals.changeme != 0) {
    puts("Well done, the 'changeme' variable has been changed!");
  } else {
    puts(
        "Uh oh, 'changeme' has not yet been changed. Would you like to try "
        "again?");
  }

  exit(0);
}
```
